{"version":3,"file":"moveable-helper.esm.js","sources":["../src/MoveableHelper.ts"],"sourcesContent":["import { Frame } from \"scenejs\";\nimport {\n    OnDragStart, OnDrag, OnRender, OnResize, OnResizeStart,\n    OnScaleStart, OnScale, OnRotate, OnRotateStart,\n    OnDragGroupStart, OnDragGroup, OnResizeGroupStart,\n    OnResizeGroup, OnScaleGroupStart, OnScaleGroup, OnRotateGroupStart, OnRotateGroup\n} from \"react-moveable\";\n\n\nexport default class MoveableHelper {\n    public static create(options: Partial<MoveableHelperOptions> ) {\n        return new MoveableHelper(options);\n    }\n    public options: Partial<MoveableHelperOptions>;\n    constructor(options: Partial<MoveableHelperOptions> = {}) {\n        this.options = {\n            useRender: false,\n            createAuto: true,\n            ...options,\n        };\n    }\n    public map = new Map<HTMLElement | SVGElement, Frame>();\n    public getFrame(el: HTMLElement | SVGElement) {\n        return this.map.get(el);\n    }\n    public createFrame(el: HTMLElement | SVGElement, properites = {}) {\n        const frame = new Frame({\n            transform: {\n                translate: \"0px, 0px\",\n                rotate: \"0deg\",\n                scale: \"1, 1\",\n            },\n        })\n\n        frame.set(properites);\n\n        this.map.set(el, frame);\n        return frame;\n    }\n    public onDragStart = (e: OnDragStart) => {\n        const frame = this.testFrame(e);\n\n        if (!frame) {\n            return false;\n        }\n        e.set(this.getTranslate(frame));\n    }\n    public onDrag = (e: OnDrag) => {\n        this.testDrag(e);\n        this.testRender(e.target);\n    }\n    public onDragGroupStart = (e: OnDragGroupStart) => {\n        e.events.forEach(ev => {\n            this.onDragStart(ev);\n        });\n    }\n    public onDragGroup = (e: OnDragGroup) => {\n        e.events.forEach(ev => {\n            this.onDrag(ev);\n        });\n    }\n    public onResizeStart = (e: OnResizeStart) => {\n        e.dragStart && this.onDragStart(e.dragStart);\n        e.setOrigin([\"%\", \"%\"]);\n    }\n    public onResize = (e: OnResize) => {\n        this.testResize(e);\n        this.testRender(e.target);\n    }\n    public onResizeGroupStart = (e: OnResizeGroupStart) => {\n        e.events.forEach(ev => {\n            this.onResizeStart(ev);\n        });\n    }\n    public onResizeGroup = (e: OnResizeGroup) => {\n        console.log(e.offsetWidth / e.offsetHeight);\n        e.events.forEach(ev => {\n            this.onResize(ev);\n        });\n    }\n    public onScaleStart = (e: OnScaleStart) => {\n        const frame = this.testFrame(e);\n\n        if (!frame) {\n            return false;\n        }\n        const scale = frame.get(\"transform\", \"scale\").split(\",\").map(value => parseFloat(value));\n\n        e.set(scale);\n        e.dragStart && this.onDragStart(e.dragStart);\n    }\n    public onScale = (e: OnScale) => {\n        this.testScale(e);\n        this.testRender(e.target);\n    }\n    public onScaleGroupStart = (e: OnScaleGroupStart) => {\n        e.events.forEach(ev => {\n            this.onScaleStart(ev);\n        });\n    }\n    public onScaleGroup = (e: OnScaleGroup) => {\n        e.events.forEach(ev => {\n            this.onScale(ev);\n        });\n    }\n    public onRotateStart = (e: OnRotateStart) => {\n        const frame = this.testFrame(e);\n\n        if (!frame) {\n            return false;\n        }\n        const rotate = parseFloat(frame.get(\"transform\", \"rotate\")) || 0;\n\n        e.set(rotate);\n        (e as any).dragStart && this.onDragStart((e as any).dragStart);\n    }\n    public onRotate = (e: OnRotate) => {\n        this.testRotate(e);\n        this.testRender(e.target);\n    }\n    public onRotateGroupStart = (e: OnRotateGroupStart) => {\n        e.events.forEach(ev => {\n            this.onRotateStart(ev);\n        });\n    }\n    public onRotateGroup = (e: OnRotateGroup) => {\n        e.events.forEach(ev => {\n            this.onRotate(ev);\n        });\n    }\n    public onRender = (e: OnRender) => {\n        const target = e.target;\n        const frame = this.getFrame(target);\n\n        if (!target || !frame) {\n            return;\n        }\n        this.render(target, frame);\n    }\n    private testFrame(e: any) {\n        const target = e.target;\n        const frame = this.getFrame(target);\n\n\n        if (frame) {\n            return frame;\n        }\n        if (!this.options.createAuto) {\n            if (e.stop) {\n                e.stop();\n                return;\n            }\n        }\n        return this.createFrame(target);\n    }\n    private getTranslate(frame: Frame) {\n        return this.testTranslate(frame).map(value => parseFloat(value) || 0);\n    }\n    private testTranslate(frame: Frame) {\n        const translate = frame.get(\"transform\", \"translate\");\n\n        if (translate) {\n            return translate.split(\",\");\n        }\n        const translateX = frame.get(\"transform\", \"translateX\");\n\n        if (translateX) {\n            const translateY = frame.get(\"transform\", \"translateY\");\n\n            return [translateX, translateY];\n        }\n\n        frame.set(\"transform\", \"translate\", \"0px,0px\");\n        return [\"0px\", \"0px\"];\n    }\n    private testDrag(e: OnDrag) {\n        const target = e.target;\n        const beforeTranslate = e.beforeTranslate;\n\n        const frame = this.getFrame(target);\n        const tx = `${beforeTranslate[0]}px`;\n        const ty = `${beforeTranslate[1]}px`;\n\n        if (frame.has(\"transform\", \"translate\")) {\n            frame.set(\"transform\", \"translate\", `${tx},${ty}`);\n        } else {\n            frame.set(\"transform\", \"translateX\", tx);\n            frame.set(\"transform\", \"translateY\", ty);\n        }\n    }\n    private testResize(e: OnResize) {\n        const target = e.target;\n        const frame = this.getFrame(target);\n\n        frame.set(\"width\", `${e.width}px`);\n        frame.set(\"height\", `${e.height}px`);\n\n        this.testDrag(e.drag);\n    }\n    private testScale(e: OnScale) {\n        const frame = this.testFrame(e);\n        const scale = e.scale;\n\n        this.testDrag(e.drag);\n        frame.set(\"transform\", \"scale\", `${scale[0]},${scale[1]}`);\n    }\n    private testRotate(e: OnRotate) {\n        const frame = this.testFrame(e);\n        const rotate = e.beforeRotate;\n\n        (e as any).drag && this.testDrag((e as any).drag);\n        frame.set(\"transform\", \"rotate\", `${rotate}deg`);\n    }\n    private testRender(target, frame = this.getFrame(target)) {\n        if (!this.options.useRender) {\n            this.render(target, frame);\n        }\n    }\n    private render(target: HTMLElement | SVGElement, frame: Frame = this.getFrame(target)) {\n        target.style.cssText += frame.toCSS();\n    }\n}\n"],"names":["options","Map","e","frame","_this","testFrame","set","getTranslate","testDrag","testRender","target","events","forEach","ev","onDragStart","onDrag","dragStart","setOrigin","testResize","onResizeStart","console","log","offsetWidth","offsetHeight","onResize","scale","get","split","map","value","parseFloat","testScale","onScaleStart","onScale","rotate","testRotate","onRotateStart","onRotate","getFrame","render","useRender","createAuto","MoveableHelper","el","properites","Frame","transform","translate","stop","createFrame","testTranslate","translateX","translateY","beforeTranslate","tx","ty","has","width","height","drag","beforeRotate","style","cssText","toCSS"],"mappings":"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"}